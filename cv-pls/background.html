<!DOCTYPE html>
<html>
  <head>
    <script>
      chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
        if (request.method == 'showIcon') {
          var enabled = localStorage.getItem('icon-enabled');
          if (enabled == 'true' || enabled === null) {
            chrome.pageAction.show(sender.tab.id);
          }
          sendResponse({});
        } else if (request.method == 'saveSetting') {
          localStorage.setItem(request.key, request.value);
          sendResponse({});
        } else if (request.method == 'getSetting') {
          sendResponse({value: localStorage.getItem(request.key)});
        } else {
          sendResponse({}); // snub them.
        }
      });
    </script>
  </head>
</html>