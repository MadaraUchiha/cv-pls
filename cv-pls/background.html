<!DOCTYPE html>
<html>
  <head>
    <script>
      // we should really do a switch statement here
      chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
        if (request.method == 'showIcon') {
          var enabled = localStorage.getItem('icon-enabled');
          if (enabled == 'true' || enabled === null) {
            chrome.pageAction.show(sender.tab.id);
          }
          sendResponse({});
        } else if (request.method == 'saveSetting') {
          localStorage.setItem(request.key, request.value);
          sendResponse({});
        } else if (request.method == 'getSetting') {
          sendResponse({value: localStorage.getItem(request.key)});
        } else if (request.method == 'getHeight') {
          sendResponse({
            height: localStorage.getItem('onebox-height'),
            unit: localStorage.getItem('onebox-heightunit')
          });
        } else if (request.method == 'getStatus') {
          sendResponse({
            status: localStorage.getItem('cv-status'),
            reason: localStorage.getItem('cv-reason')
          });
        } else if (request.method == 'getPolling') {
          sendResponse({
            poll: localStorage.getItem('poll'),
            interval: localStorage.getItem('pollinterval')
          });
        } else {
          sendResponse({}); // snub them.
        }
      });
    </script>
  </head>
</html>